<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>SPSS-like Data Entry</title>
<style>
body { font-family: Arial; margin: 20px }
table { border-collapse: collapse; margin-top: 10px }
td, th { border: 1px solid #444; padding: 5px }
input { margin: 5px }
button { margin: 5px }
.section { border: 1px solid #aaa; padding: 10px; margin-bottom: 20px }
iframe { display: none }
</style>
</head>

<body>

<h1>SPSS-like Data Entry (HTML + Google Sheet)</h1>

<div class="section">
<h2>Variable View</h2>
<input id="varName" placeholder="T√™n bi·∫øn">
<button onclick="addVariable()">Th√™m bi·∫øn</button>
<ul id="varList"></ul>
</div>

<div class="section">
<h2>Data View</h2>
<button onclick="addRow()">Th√™m b·ªánh nh√¢n</button>
<table id="dataTable"></table>
</div>

<div class="section">
<button onclick="submitAll()">G·ª≠i sang Google Sheet</button>
</div>

<iframe name="hiddenFrame"></iframe>

<script>
const GOOGLE_SHEET_URL =
"https://script.google.com/macros/s/AKfycbxQRtmde0AGSQqLcjg1WO8ijQ3NDAKa5Mh7yOmdA0fSgHDGYgJ5E70dtrx2H-Xdz4NQ/exec";

let variables = ["ID"];
let data = [];

function addVariable() {
  const name = varName.value.trim();
  if (!name || variables.includes(name)) return;
  variables.push(name);
  varName.value = "";
  render();
}

function addRow() {
  const row = {};
  variables.forEach(v => row[v] = "");
  row.ID = data.length + 1;
  data.push(row);
  render();
}

function render() {
  varList.innerHTML = variables.map(v => `<li>${v}</li>`).join("");
  dataTable.innerHTML = "";

  const h = dataTable.insertRow();
  variables.forEach(v => h.insertCell().innerText = v);

  data.forEach(r => {
    const tr = dataTable.insertRow();
    variables.forEach(v => {
      const td = tr.insertCell();
      td.contentEditable = v !== "ID";
      td.innerText = r[v];
      td.oninput = () => r[v] = td.innerText;
    });
  });
}

/* üî¥ C√ÅCH DUY NH·∫§T KH√îNG CORS */
function submitAll() {
  if (data.length === 0) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu");

  data.forEach(row => {
    const form = document.createElement("form");
    form.method = "POST";
    form.action = GOOGLE_SHEET_URL;
    form.target = "hiddenFrame";

    const h = document.createElement("input");
    h.name = "headers";
    h.value = JSON.stringify(variables);

    const v = document.createElement("input");
    v.name = "values";
    v.value = JSON.stringify(variables.map(x => row[x]));

    form.appendChild(h);
    form.appendChild(v);
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
  });

  alert("ƒê√£ g·ª≠i d·ªØ li·ªáu sang Google Sheet");
}
</script>

</body>
</html>
